<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</title>
<link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --orange: #FFA500;
    --orange-2: #FFB84D;
    --blue: #0047AB;
    --blue-2: #0066CC;
    --glass: rgba(255,255,255,0.9);
  }
  body {
    font-family: 'Prompt', sans-serif;
    background: linear-gradient(135deg, var(--orange) 0%, #ffffff 60%, var(--blue));
    color: #002366;
    margin: 0;
    padding: 0;
  }
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 18px;
    background: transparent;
  }
  .btn-nav {
    padding: 8px 14px;
    border: none;
    border-radius: 10px;
    background: var(--glass);
    color: #002366;
    font-weight: 600;
    cursor: pointer;
  }
  .container {
    display: flex;
    gap: 12px;
    padding: 12px;
    align-items: flex-start;
  }
  .order-summary {
    width: 320px;
    background: var(--glass);
    border-radius: 16px;
    padding: 14px;
    margin-right: 8px;
    min-width: 260px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(0, 0, 0, 0.05);
  }
  .menu-grid {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 14px;
  }
  .menu-item {
    background: #fff;
    border-radius: 14px;
    text-align: center;
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    padding: 12px;
    cursor: pointer;
    transition: transform .14s ease;
  }
  .menu-item:hover { transform: translateY(-6px); }

  /* üî∏ ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
  .cart-icon {
    display: none;
    position: fixed;
    top: 12px;
    right: 16px;
    background: var(--orange);
    color: #fff;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    font-size: 22px;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    cursor: pointer;
    z-index: 1200;
  }
  .cart-count {
    position: absolute;
    top: 4px;
    right: 6px;
    background: #ff2b2b;
    color: white;
    font-size: 13px;
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 12px;
  }
  #mobileCartOverlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    z-index: 1190;
  }
  #mobileCartPopup {
    display: none;
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    max-height: 85vh;
    background: #fff;
    border-radius: 20px 20px 0 0;
    box-shadow: 0 -6px 20px rgba(0,0,0,0.2);
    z-index: 1201;
    overflow-y: auto;
    padding: 14px;
  }
  #mobileCartPopup h3 {
    text-align: center;
    color: #0047AB;
    margin-top: 0;
  }

  /* ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
  @media (max-width: 768px) {
    .order-summary { display: none !important; }
    .cart-icon { display: flex; }
  }
</style>
</head>

<body>
<header>
  <button class="btn-nav" onclick="playClick(); goHome()">‚Üê Home</button>
  <button class="btn-nav" onclick="playClick(); goBack()">‚Üê Back</button>
</header>

<!-- üîπ ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) -->
<div class="cart-icon" id="cartIcon" onclick="playClick(); toggleMobileCart()">
  üõí
  <div class="cart-count" id="cartCount">0</div>
</div>

<div id="mobileCartOverlay" onclick="closeMobileCart()"></div>
<div id="mobileCartPopup">
  <div id="mobileCartContent"></div>
</div>

<h1>‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h1>
<div class="container">
  <div class="order-summary" id="orderSummary" style="display:none;">
    <h3>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
    <div id="orderItems"></div>
    <div class="summary-total" id="totalSummary"></div>
    <button onclick="playClick(); promptDiscountAuth()">üéÅ ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</button>
    <button onclick="playClick(); submitOrder()">‚úÖ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
    <button onclick="playClick(); cancelOrder()">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    <button onclick="playClick(); removeDiscount()">üßπ ‡∏•‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</button>
  </div>
  <div class="menu-grid" id="menuGrid">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π...</div>
</div>

<!-- ‚úÖ ‡∏™‡πà‡∏ß‡∏ô JS -->
<script>
let order = {}, discountPercent = 0;

/* --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Popup --- */
function showPopup(id){document.getElementById('overlay')?.style.display='block';document.getElementById(id).style.display='block';}
function closeAllPopups(){document.querySelectorAll('.popup').forEach(p=>p.style.display='none');document.getElementById('overlay')?.style.display='none';}

/* --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î --- */
function promptDiscountAuth(){showPopup('authPopup');}
function submitPin(){const pin=document.getElementById('pinInput').value;if(pin==='000000'){closeAllPopups();showPopup('discountPopup');clearPin();}else{alert('‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');clearPin();}}
function applyDiscount(p){discountPercent=p;closeAllPopups();updateSummary();}
function removeDiscount(){discountPercent=0;updateSummary();}
function appendPin(n){const i=document.getElementById('pinInput');if(i.value.length<6)i.value+=n;}
function clearPin(){document.getElementById('pinInput').value='';}

/* --- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π --- */
function addToOrder(item){
  const n=item.name,p=Number(item.price);
  if(!order[n])order[n]={price:p,quantity:1};else order[n].quantity++;
  updateSummary();updateCartCount();
}
function changeQty(n,c){if(order[n]){order[n].quantity+=c;if(order[n].quantity<=0)delete order[n];updateSummary();updateCartCount();}}
function removeItem(n){delete order[n];updateSummary();updateCartCount();}
function updateSummary(){
  const s=document.getElementById('orderSummary'),
        items=document.getElementById('orderItems'),
        t=document.getElementById('totalSummary');
  items.innerHTML='';let subtotal=0;
  for(const n in order){
    const it=order[n];
    subtotal+=it.price*it.quantity;
    items.innerHTML+=`
      <div class='order-item'>
        <div>${n}</div>
        <div class='controls'>
          <button onclick="changeQty('${n}',-1)">-</button>
          <span>${it.quantity}</span>
          <button onclick="changeQty('${n}',1)">+</button>
          <button onclick="removeItem('${n}')">üóëÔ∏è</button>
        </div>
      </div>`;
  }
  const discount=subtotal*(discountPercent/100),
        vat=(subtotal-discount)*0.07,
        net=subtotal-discount+vat;
  t.innerHTML=`‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${subtotal.toFixed(2)} ‡∏ø<br>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (${discountPercent}%): ${discount.toFixed(2)} ‡∏ø<br>VAT 7%: ${vat.toFixed(2)} ‡∏ø<br><strong>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏∏‡∏ó‡∏ò‡∏¥: ${net.toFixed(2)} ‡∏ø</strong>`;
  s.style.display=Object.keys(order).length?'block':'none';
}

/* --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ --- */
function updateCartCount(){
  const count=Object.values(order).reduce((a,b)=>a+b.quantity,0);
  document.getElementById('cartCount').innerText=count;
}
function toggleMobileCart(){
  const overlay=document.getElementById('mobileCartOverlay');
  const popup=document.getElementById('mobileCartPopup');
  if(popup.style.display==='block'){closeMobileCart();}
  else{
    overlay.style.display='block';
    popup.style.display='block';
    renderMobileCart();
  }
}
function closeMobileCart(){
  document.getElementById('mobileCartOverlay').style.display='none';
  document.getElementById('mobileCartPopup').style.display='none';
}
function renderMobileCart(){
  const c=document.getElementById('mobileCartContent');
  let html='<h3>üõí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>';
  if(Object.keys(order).length===0){c.innerHTML='<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>';return;}
  for(const n in order){
    const it=order[n];
    html+=`
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <span>${n} (${it.price}‡∏ø)</span>
        <div>
          <button onclick="changeQty('${n}',-1)">-</button>
          ${it.quantity}
          <button onclick="changeQty('${n}',1)">+</button>
          <button onclick="removeItem('${n}')">üóëÔ∏è</button>
        </div>
      </div>`;
  }
  html+=`<hr><div style="text-align:center;">
  <button onclick="playClick(); submitOrder()">‚úÖ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
  <button onclick="playClick(); closeMobileCart()">‡∏õ‡∏¥‡∏î</button></div>`;
  c.innerHTML=html;
}

/* --- ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á --- */
let audioCtx;
function initAudio(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();}
function playClick(){
  initAudio();
  const osc=audioCtx.createOscillator(),gain=audioCtx.createGain();
  osc.connect(gain);gain.connect(audioCtx.destination);
  osc.type="square";osc.frequency.value=550;gain.gain.value=0.08;
  osc.start();osc.stop(audioCtx.currentTime+0.1);
  if(navigator.vibrate)navigator.vibrate(40);
}
function playError(){
  initAudio();
  const osc=audioCtx.createOscillator(),gain=audioCtx.createGain();
  osc.connect(gain);gain.connect(audioCtx.destination);
  osc.type="sawtooth";osc.frequency.value=180;gain.gain.value=0.12;
  osc.start();osc.stop(audioCtx.currentTime+0.25);
  if(navigator.vibrate)navigator.vibrate([100,60,100]);
}
const _alert=window.alert;window.alert=function(m){playError();_alert(m);};

/* --- ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏≤‡∏Å Google Script --- */
fetch("https://script.google.com/macros/s/AKfycbwvYTBu1lZ-IukUtsg2ylzALbEEoYARxjgyWh7VmTDP9lTXhs6Axv7uNcRIE3DCGjaQ/exec")
.then(r=>r.json())
.then(data=>{
  const g=document.getElementById('menuGrid');
  g.innerHTML='';
  data.forEach(it=>{
    const d=document.createElement('div');
    d.className='menu-item';
    d.innerHTML=`<div class='image-placeholder'>[‡∏£‡∏π‡∏õ‡∏≠‡∏≤‡∏´‡∏≤‡∏£]</div><div>${it.name}</div><div>${it.price} ‡∏ö‡∏≤‡∏ó</div>`;
    d.onclick=()=>{playClick();addToOrder(it);};
    g.appendChild(d);
  });
});
</script>
</body>
</html>